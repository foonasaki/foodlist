<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>商品一覧</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <h2 style="text-align:center;">商品一覧</h2>

  <div class="table-container">
    <table id="productTable">
      <thead>
        <tr>
          <th>分類</th>
          <th>商品</th>
          <th>価格</th>
          <th>販売場所</th>
          <th>備考</th>
          <th>リンク</th>
        </tr>
        <!-- 検索用入力欄 -->
        <tr>
          <th><input type="text" placeholder="分類で検索" data-column="分類"></th>
          <th><input type="text" placeholder="商品名で検索" data-column="商品"></th>
          <!-- <th><input type="text" placeholder="価格で検索" data-column="価格"></th> -->
          <th><input type="text" placeholder="販売場所で検索" data-column="販売場所"></th>
          <!-- <th><input type="text" placeholder="備考で検索" data-column="備考"></th> -->
          <!-- <th><input type="text" placeholder="リンクで検索" data-column="URL"></th> -->
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    fetch('json/menu_data.json')
      .then(response => response.json())
      .then(data => {
        const tbody = document.querySelector('#productTable tbody');
        const searchInputs = document.querySelectorAll('thead input');

        // 現在の検索条件を保持
        const filters = {
          分類: '',
          商品: '',
          価格: '',
          販売場所: '',
          備考: '',
          URL: ''
        };

        const renderTable = () => {
          tbody.innerHTML = '';
          for (const [name, info] of Object.entries(data)) {
            // 各列ごとに一致チェック
            const match =
              (filters.分類 === '' || info.分類.toLowerCase().includes(filters.分類)) &&
              (filters.商品 === '' || name.toLowerCase().includes(filters.商品)) &&
              (filters.価格 === '' || String(info.価格).toLowerCase().includes(filters.価格)) &&
              (filters.販売場所 === '' || info.販売場所.toLowerCase().includes(filters.販売場所)) &&
              (filters.備考 === '' || info.備考.toLowerCase().includes(filters.備考)) &&
              (filters.URL === '' || info.URL.toLowerCase().includes(filters.URL));

            if (match) {
              const row = document.createElement('tr');
              row.innerHTML = `
                <td>${info.分類}</td>
                <td>
                  <div style="display: flex; flex-direction: column; align-items: center;">
                    <span>${ (info.name !== null && info.name !== '') ? info.name : '-' }</span>
                     ${ info.画像ファイル名 ? `<img src="images/${info.画像ファイル名}" alt="${name}">` : '' }
                  </div>
                </td>
                <td>${ (info.価格 !== null && info.価格 !== '') ? info.価格 : '-' }</td>
                <td>${
                  Array.isArray(info.販売場所)
                    ? (info.販売場所.length > 0 ? info.販売場所.join('<br>') : '-')
                    : (info.販売場所 ? info.販売場所 : '-')
                }</td>
                <td>${ (info.備考 !== null && info.備考 !== '') ? info.備考 : '-' }</td>
                <td><a href="${info.URL}" target="_blank" rel="noopener noreferrer">${info.URL}</a></td>
              `;
              tbody.appendChild(row);
            }
          }
        };

        // 各入力欄にイベントを設定
        searchInputs.forEach(input => {
          input.addEventListener('input', e => {
            const column = e.target.getAttribute('data-column');
            filters[column] = e.target.value.toLowerCase();
            renderTable();
          });
        });

        // 初期表示
        renderTable();
      })
      .catch(error => {
        console.error('JSONの読み込みに失敗しました:', error);
      });
  </script>
</body>
</html>
